<div class="container">
  <h2>Projet : <%=@home.name%></h2>
  <%= link_to "Retour", homes_path, class: 'btn btn-secondary' %>
  <p>Localisation : <%=@home.address%></p>

  <div id="map" data-controller="map-home">
    <div data-map-home-target="lat" data-value = "<%= @home.latitude %>"> </div>
    <div data-map-home-target="long" data-value = "<%= @home.longitude %>"> </div>
  </div>

  <p>Consommation annuel (kW/h) : <%= @home.home_consumption_months.sum.to_i%></p>
  <p>Budget électrique annuel : <%= @home.price_consumption_months.sum.to_i%> €</p>
  <canvas data-controller="consumption-chart">
    <div data-consumption-chart-target="consumptionHome" data-value = "<%= @home.home_consumption_months %>"> </div>
  </canvas>

  <div class="mt-3">
    <%= link_to "Nouvelle installation", new_home_photovoltaic_path(@home), class: 'btn btn-primary' %>
    <%= link_to "Modifier projet", edit_home_path(@home), class: 'btn btn-secondary' %>
  </div>

  <h4 class="mt-5">Scénarios d'installation :</h4>
  <%@photovoltaics.each do |photovoltaic|%>

      <div class="mt-4">
        <%= link_to "Scénario à #{photovoltaic.power}", home_photovoltaic_path(@home, photovoltaic), class: 'btn btn-primary' %>
      </div>

      <div>
        <strong>Synthèse énergétique :</strong>
        <p>Production annuelle (kW/h) : <%= photovoltaic.production_months.sum.to_i %></p>
        <p>Production autoconsommée (kW/h) : <%=photovoltaic.self_consumption_months.sum.to_i%> </p>
        <p>Renvoi sur le réseau (kW/h) : <%=photovoltaic.back_energy_months.sum.to_i%> </p>
      </div>

      <div>
        <strong>Synthèse financiere :</strong>
        <p> Investissement (€): <%=photovoltaic.investment%> </p>
        <p> ROI (année): <%=photovoltaic.roi%> </p>
        <p> Bénéfice sur la durée de vie de l'installation (€): <%=photovoltaic.profit%> </p>
      </div>

      <div>
        <strong>Caractéristiques de l'installation</strong>
        <% nb_solar_panel = (photovoltaic.power / Photovoltaic::POWER_BY_PANEL).ceil %>
        <p>Nombre de panneaux solaires : <%= nb_solar_panel %> </p>
        <p>Surface utile : <%= (nb_solar_panel * Photovoltaic::AREA_BY_PANEL).round(2) %> m2</p>
      </div>

      <div>
        <%= link_to "Supprimer", home_photovoltaic_path(@home, photovoltaic), class: 'btn btn-secondary', data: {turbo_method: :delete, turbo_confirm: "Voulez vous supprimer cette installation?"} %>
        <%= link_to "Modifier puissance", edit_home_photovoltaic_path(@home, photovoltaic), class: 'btn btn-secondary' %>
      </div>
  <%end%>
</div>
